<GuidFile::-Components::FileDetailLayout
    @rightColumnClosed={{this.rightColumnClosed}}
    @isMobile={{this.media.isMobile}}
>
    <:header>
        <h3>
            <OsfLink
                data-test-project-link
                data-analytics-name='Linked project'
                local-class='project-link'
                @route={{if (eq this.model.fileModel.target.type 'registrations') 'guid-registration' 'guid-node'}}
                @models={{array this.model.fileModel.target.id}}
            >
                {{this.model.fileModel.target.title}}
            </OsfLink>
        </h3>
        <div local-class='flex-container-row'>
            <h2 data-test-filename>
                {{this.model.displayName}}
                {{#if this.viewedVersion}}
                    ({{t 'general.version'}}: {{this.viewedVersion}})
                {{/if}}
            </h2>
            <FileActionsMenu @item={{this.model}} @onDelete={{this.onDelete}} @allowRename={{false}} />
        </div>
    </:header>
    <:body>
        <div data-test-file-renderer id='mfrIframeParent' local-class='file-renderer'>
            <FileRenderer
                @download={{this.model.links.download}}
                @version={{this.viewedVersion}}
            />
        </div>
    </:body>
    <:right>
        {{#if (or this.model.shouldShowTags this.model.shouldShowRevisions) }}
            {{#if this.revisionsOpened}}
                <section data-test-revisions-tab local-class='file-detail-revisions'>
                    <h2 local-class='file-detail-right-section-heading'>{{t 'general.revisions'}}</h2>
                    <ol local-class='file-detail-revision-list' reversed>
                        <hr aria-hidden='true'>
                        {{#if this.model.getRevisions.isRunning}}
                            <LoadingIndicator @dark={{true}} />
                        {{else}}
                            {{#each this.model.waterButlerRevisions as |version|}}
                                <FileVersion
                                    @version={{version}}
                                    @downloadUrl={{this.model.links.download}}
                                    @changeVersion={{this.changeVersion}}
                                />
                                <hr aria-hidden='true'>
                            {{else}}
                                {{t 'file_detail.no_revisions'}}
                            {{/each}}
                        {{/if}}
                    </ol>
                </section>
            {{/if}}
            {{#if this.tagsOpened}}
                <div local-class='right-container'>
                    <h2>{{t 'general.tags'}}</h2>
                    <TagsWidget
                        @taggable={{this.model.fileModel}}
                        @readOnly={{not this.model.userCanEditMetadata}}
                        @inline={{true}}
                    />
                </div>
            {{/if}}
            {{#if this.metadataOpened}}
                <div local-class='right-container {{if this.isMobile 'Mobile'}}' data-test-metadata-tab>
                    <FileMetadataManager @file={{this.model.fileModel}} as |manager|>
                        <div local-class='metadata-title-edit-download'>
                            <h2 local-class='metadata-heading'>
                                {{t 'file_detail.file_metadata'}}
                            </h2>
                            <div local-class='edit-download-buttons'>
                                {{#unless manager.inEditMode}}
                                    {{#if manager.userCanEdit}}
                                       <BsButton
                                          data-test-edit-metadata-button
                                          aria-label={{t 'general.edit'}}
                                          data-analytics-name='Edit metadata'
                                          @layout='fake-link'
                                          @onClick={{@manager.edit}}
                                        >
                                            <FaIcon @icon='pencil-alt' />
                                        </BsButton>
                                    {{/if}}
                                    <OsfLink
                                        data-test-download-button
                                        aria-label={{t 'general.download'}}
                                        @href='#'
                                    >
                                        <FaIcon @icon='download' />
                                    </OsfLink>
                                {{/unless}}
                            </div>
                        </div>
                        {{#if manager.isGatheringData}}
                            <LoadingIndicator @dark={{true}} />
                        {{else}}
                            {{#if manager.inEditMode}}
                                <div local-class='metadata-form-and-buttons' data-test-edit-metadata-form>
                                    <div local-class='edit-metadata-form'>
                                        <FormControls data-test-edit-metadata-form @changeset={{manager.changeset}} as |form|>
                                            <form.textarea
                                                data-test-title-field
                                                @valuePath='title'
                                                @label={{t 'file_detail.title'}}
                                            />
                                            <form.textarea
                                                data-test-description-field
                                                @valuePath='description'
                                                @label={{t 'file_detail.description'}}
                                            />
                                            <form.select
                                                data-test-select-resource-type
                                                @options={{manager.resourceTypeGeneralOptions}}
                                                @label={{t 'file_detail.resource_type_general'}}
                                                @valuePath='resourceTypeGeneral'
                                                as |option|
                                            >
                                                {{option}}
                                            </form.select>
                                            <form.select
                                                data-test-select-resource-language
                                                @options={{manager.languageCodes}}
                                                @label={{t 'file_detail.language'}}
                                                @onchange={{manager.changeLanguage}}
                                                @valuePath='languageObject'
                                                as |option|
                                            >
                                                {{option.name}}
                                            </form.select>
                                        </FormControls>
                                    </div>
                                    <div local-class='edit-metadata-save-cancel-buttons'>
                                        <Button
                                            aria-label={{t 'general.cancel'}}
                                            data-analytics-name='Cancel editing metadata'
                                            data-test-cancel-editing-metadata-button
                                            @type='secondary'
                                            {{on 'click' manager.cancel}}
                                        >
                                            {{t 'general.cancel'}}
                                        </Button>
                                        <Button
                                            aria-label={{t 'general.save'}}
                                            data-analytics-name='Save metadata'
                                            data-test-save-metadata-button
                                            @type='primary'
                                            {{on 'click' manager.save}}
                                        >
                                            {{t 'general.save'}}
                                        </Button>
                                    </div>
                                </div>
                            {{else}}
                                <div data-test-file-title-label>{{t 'file_detail.title'}}</div>
                                <div data-test-file-title>{{manager.metadataRecord.title}}</div>
                                <div data-test-file-description-label>{{t 'file_detail.description'}}</div>
                                <div data-test-file-description>{{manager.metadataRecord.description}}</div>
                                <div data-test-file-resource-type-label>{{t 'file_detail.resource_type_general'}}</div>
                                <div data-test-file-resource-type>{{manager.metadataRecord.resourceTypeGeneral}}</div>
                                <div data-test-file-language-label>{{t 'file_detail.language'}}</div>
                                <div data-test-file-language>{{manager.languageFromCode}}</div>
                                <h2 data-test-metadata-node>{{t (concat 'file_detail.metadata_' manager.nodeWord)}}</h2>
                                <div data-test-target-funder-div>
                                    {{#each manager.targetMetadata.funders as |funder|}}
                                        <div data-test-target-funder-name-label>{{t 'file_detail.funder'}}</div>
                                        <div data-test-target-funder-name={{funder.funder_name}}>
                                            {{funder.funder_name}}
                                        </div>
                                        <div data-test-target-funder-award-title-label>{{t 'file_detail.award_title'}}</div>
                                        <div data-test-target-funder-award-title={{funder.funder_name}}>
                                            {{funder.award_title}}
                                        </div>
                                        <div data-test-target-funder-award-uri-label>{{t 'file_detail.award_uri'}}</div>
                                        <div data-test-target-funder-award-uri={{funder.funder_name}}>
                                            {{funder.award_uri}}
                                        </div>
                                        <div data-test-target-funder-award-number-label>{{t 'file_detail.award_number'}}</div>
                                        <div data-test-target-funder-award-number={{funder.funder_name}}>
                                            {{funder.award_number}}
                                        </div>
                                    {{/each}}
                                </div>
                                <div data-test-target-title-label>{{t 'file_detail.title'}}</div>
                                <div data-test-target-title>{{manager.target.title}}</div>
                                <div data-test-target-description-label>{{t 'file_detail.description'}}</div>
                                <div data-test-target-description>{{manager.target.description}}</div>
                                <div data-test-target-contributors-label>{{t 'file_detail.contributors'}}</div>
                                <ContributorList
                                    data-test-file-contributors
                                    @model={{manager.target}}
                                    @shouldLinkUsers={{true}}
                                    @shouldTruncate={{false}}
                                />
                                <div data-test-file-institutions-label>{{t 'file_detail.institutions'}}</div>
                                <div data-test-file-institutions>
                                    {{#each this.targetInstitutions as |institution|}}
                                        <div>{{institution.name}}</div>
                                    {{/each}}
                                </div>
                            {{else}}
                                <dl>
                                    <dt data-test-file-title-label>{{t 'file_detail.title'}}</dt>
                                    <dd data-test-file-title>{{manager.metadataRecord.title}}</dd>
                                    <dt data-test-file-description-label>{{t 'file_detail.description'}}</dt>
                                    <dd data-test-file-description>{{manager.metadataRecord.description}}</dd>
                                    <dt data-test-file-resource-type-label>{{t 'file_detail.resource_type_general'}}</dt>
                                    <dd data-test-file-resource-type>{{manager.metadataRecord.resourceTypeGeneral}}</dd>
                                    <dt data-test-file-language-label>{{t 'file_detail.language'}}</dt>
                                    <dd data-test-file-language>{{manager.languageFromCode}}</dd>
                                </dl>
                                <h2 local-class='node-type-heading' data-test-metadata-node>{{t (concat 'file_detail.metadata_' manager.nodeWord)}}</h2>
                                <div data-test-target-funder-div>
                                    {{#each manager.targetMetadata.funders as |funder|}}
                                        <dl>
                                            <dt data-test-target-funder-name-label>{{t 'file_detail.funder'}}</dt>
                                            <dd data-test-target-funder-name={{funder.funder_name}}>
                                                {{funder.funder_name}}
                                            </dd>
                                            <dt data-test-target-funder-award-title-label>{{t 'file_detail.award_title'}}</dt>
                                            <dd data-test-target-funder-award-title={{funder.funder_name}}>
                                                {{funder.award_title}}
                                            </dd>
                                            <dt data-test-target-funder-award-uri-label>{{t 'file_detail.award_uri'}}</dt>
                                            <dd data-test-target-funder-award-uri={{funder.funder_name}}>
                                                {{funder.award_uri}}
                                            </dd>
                                            <dt data-test-target-funder-award-number-label>{{t 'file_detail.award_number'}}</dt>
                                            <dd data-test-target-funder-award-number={{funder.funder_name}}>
                                                {{funder.award_number}}
                                            </dd>
                                        </dl>
                                    {{/each}}
                                </div>
                                <dl>
                                    <dt data-test-file-title-label>{{t 'file_detail.title'}}</dt>
                                    <dd data-test-file-title>{{manager.target.title}}</dd>
                                    <dt data-test-file-description-label>{{t 'file_detail.description'}}</dt>
                                    <dd data-test-file-description>{{manager.target.description}}</dd>
                                    <dt data-test-file-contributors-label>{{t 'file_detail.contributors'}}</dt>
                                    <ContributorList
                                        data-test-target-contributors
                                        local-class='contributor-list'
                                        @model={{manager.target}}
                                        @shouldLinkUsers={{true}}
                                        @shouldTruncate={{false}}
                                    />
                                    <dt local-class='affiliated-institutions'>{{t 'file_detail.institutions'}}</dt>
                                    <div data-test-target-institutions>
                                        {{#each this.targetInstitutions as |institution|}}
                                            <dd>{{institution.name}}</dd>
                                        {{/each}}
                                    </div>
                                    <div local-class='affiliated-institutions' data-test-file-institutions-label>{{t 'file_detail.institutions'}}</div>
                                    <div data-test-file-institutions>
                                        {{#each this.targetInstitutions as |institution|}}
                                            <div>{{institution.name}}</div>
                                        {{/each}}
                                    </div>
                                    <div data-test-file-license-name-label>{{t 'file_detail.license'}}</div>
                                    <div data-test-file-license-name>{{manager.targetLicense.name}}</div>
                                    <div data-test-file-resource-type-label>{{t 'file_detail.resource_type_general'}}</div>
                                    <div data-test-file-resource-type>{{manager.targetMetadata.resourceTypeGeneral}}</div>
                                    <div data-test-file-language-label>{{t 'file_detail.language'}}</div>
                                    <div data-test-file-language>{{manager.targetMetadata.language}}</div>
                                </dl>
                            {{/if}}
                        {{/if}}
                    </FileMetadataManager>
                </div>
            {{/if}}
        {{/if}}
    </:right>
    <:rightButtons>
        {{#if (or this.model.shouldShowTags this.model.shouldShowRevisions) }}
            {{#if this.media.isMobile}}
                <BsButton
                    data-test-file-renderer-button
                    data-analytics-name='File renderer button'
                    local-class='slide-buttons {{if this.rightColumnClosed 'active'}}'
                    @size='lg'
                    @onClick={{this.toggleFileRenderer}}
                >
                    <FaIcon @icon='file-alt' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
            <BsButton
                aria-label={{if this.metadataOpened (t 'file_detail.close_metadata') (t 'file_detail.view_metadata')}}
                data-test-metadata-button
                data-analytics-name='Metadata button'
                local-class='slide-buttons {{if this.metadataOpened 'active'}}'
                @size='lg'
                @onClick={{this.toggleMetadata}}
            >
                <FaIcon @icon='info-circle' @fixedWidth={{true}}/>
            </BsButton>
            {{#if this.model.shouldShowRevisions}}
                <BsButton
                    aria-label={{if this.revisionsOpened (t 'file_detail.close_revisions') (t 'file_detail.view_revisions')}}
                    data-test-versions-button
                    data-analytics-name='Versions button'
                    local-class='slide-buttons {{if this.revisionsOpened 'active'}}'
                    @size='lg'
                    @onClick={{this.toggleRevisions}}
                >
                    <FaIcon @icon='history' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
            {{#if this.model.shouldShowTags}}
                <BsButton
                    aria-label={{if this.tagsOpened (t 'file_detail.close_tags') (t 'file_detail.view_tags')}}
                    data-test-tags-button
                    data-analytics-name='Tags button'
                    local-class='slide-buttons {{if this.tagsOpened 'active'}}'
                    @size='lg'
                    @onClick={{this.toggleTags}}
                >
                    <FaIcon @icon='tags' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
        {{/if}}
    </:rightButtons>
</GuidFile::-Components::FileDetailLayout>
