<GuidFile::-Components::FileDetailLayout
    @rightColumnClosed={{this.rightColumnClosed}}
    @isMobile={{this.media.isMobile}}
>
    <:header>
        <h3>
            <OsfLink
                data-test-project-link
                data-analytics-name='Linked project'
                local-class='ProjectLink'
                @route={{if (eq this.model.fileModel.target.type 'registrations') 'guid-registration' 'guid-node'}}
                @models={{array this.model.fileModel.target.id}}
            >
                {{this.model.fileModel.target.title}}
            </OsfLink>
        </h3>
        <div local-class='FlexContainerRow'>
            <h2 data-test-filename>
                {{this.model.displayName}}
                {{#if this.viewedVersion}}
                    ({{t 'general.version'}}: {{this.viewedVersion}})
                {{/if}}
            </h2>
            <FileActionsMenu @item={{this.model}} @onDelete={{this.onDelete}} @allowRename={{false}} />
        </div>
    </:header>
    <:body>
        <div data-test-file-renderer id='mfrIframeParent' local-class='FileRenderer'>
            <FileRenderer
                @download={{this.model.links.download}}
                @version={{this.viewedVersion}}
            />
        </div>
    </:body>
    <:right>
        {{#if (or this.model.shouldShowTags this.model.shouldShowRevisions) }}
            {{#if this.revisionsOpened}}
                <section data-test-revisions-tab local-class='FileDetail__revisions'>
                    <h2 local-class='FileDetail__right-section-heading'>{{t 'general.revisions'}}</h2>
                    <ol local-class='FileDetail__revision-list' reversed>
                        <hr aria-hidden='true'>
                        {{#if this.model.getRevisions.isRunning}}
                            <LoadingIndicator @dark={{true}} />
                        {{else}}
                            {{#each this.model.waterButlerRevisions as |version|}}
                                <FileVersion
                                    @version={{version}}
                                    @downloadUrl={{this.model.links.download}}
                                    @changeVersion={{this.changeVersion}}
                                />
                                <hr aria-hidden='true'>
                            {{else}}
                                {{t 'file_detail.no_revisions'}}
                            {{/each}}
                        {{/if}}
                    </ol>
                </section>
            {{/if}}
            {{#if this.tagsOpened}}
                <div local-class='RightContainer'>
                    <h2>{{t 'general.tags'}}</h2>
                    <TagsWidget
                        @taggable={{this.model.fileModel}}
                        @readOnly={{not this.model.userCanEditMetadata}}
                        @inline={{true}}
                    />
                </div>
            {{/if}}
            {{#if this.metadataOpened}}
                <div local-class='RightContainer'>
                    <FileMetadataManager @file={{this.model.fileModel}} as |manager|>
                        <div local-class='metadata-title-edit-download'>
                            <h2>
                                {{t 'file_detail.file_metadata'}}
                            </h2>
                            {{#unless manager.inEditMode}}
                                {{#if manager.userCanEdit}}
                                    <Button
                                        data-test-edit-metadata-button
                                        aria-label={{t 'general.edit'}}
                                        data-analytics-name='Edit metadata'
                                        @layout='fake-link'
                                        {{on 'click' manager.edit}}
                                    >
                                        <FaIcon @icon='pencil-alt' />
                                    </Button>
                                {{/if}}
                                <OsfLink
                                    data-test-download-button
                                    aria-label={{t 'general.download'}}
                                    @href='#'
                                >
                                    <FaIcon @icon='download' />
                                </OsfLink>
                            {{/unless}}
                        </div>
                        {{#if manager.isGatheringData}}
                            <LoadingIndicator @dark={{true}} />
                        {{else}}
                            {{#if manager.inEditMode}}
                                <FormControls @changeset={{manager.changeset}} as |form|>
                                    <form.textarea
                                        data-test-title-field
                                        @valuePath='title'
                                        @label={{t 'file_detail.title'}}
                                    />
                                    <form.textarea
                                        data-test-description-field
                                        @valuePath='description'
                                        @label={{t 'file_detail.description'}}
                                    />
                                    <form.select
                                        data-test-select-resource-type
                                        @options={{manager.resourceTypeGeneralOptions}}
                                        @label={{t 'file_detail.resource_type_general'}}
                                        @valuePath='resourceTypeGeneral'
                                        as |option|
                                    >
                                        {{option}}
                                    </form.select>
                                    <form.select
                                        data-test-select-resource-language
                                        @options={{manager.languageCodes}}
                                        @label={{t 'file_detail.language'}}
                                        @onchange={{manager.changeLanguage}}
                                        @valuePath='languageObject'
                                        as |option|
                                    >
                                        {{option.name}}
                                    </form.select>
                                </FormControls>
                                <Button
                                    data-test-cancel-editing-metadata-button
                                    aria-label={{t 'general.cancel'}}
                                    data-analytics-name='Cancel editing metadata'
                                    @layout='fake-link'
                                    {{on 'click' manager.cancel}}
                                >
                                    {{t 'general.cancel'}}
                                </Button>
                                <Button
                                    data-test-save-metadata-button
                                    aria-label={{t 'general.save'}}
                                    data-analytics-name='Save metadata'
                                    @layout='fake-link'
                                    {{on 'click' manager.save}}
                                >
                                    {{t 'general.save'}}
                                </Button>
                            {{else}}
                                <dl>
                                    <dt>{{t 'file_detail.title'}}</dt>
                                    <dd data-test-file-title>{{manager.metadataRecord.title}}</dd>
                                    <dt>{{t 'file_detail.description'}}</dt>
                                    <dd data-test-file-description>{{manager.metadataRecord.description}}</dd>
                                    <dt>{{t 'file_detail.resource_type_general'}}</dt>
                                    <dd data-test-file-resource-type>{{manager.metadataRecord.resourceTypeGeneral}}</dd>
                                    <dt>{{t 'file_detail.language'}}</dt>
                                    <dd data-test-file-language>{{manager.languageFromCode}}</dd>
                                    <h2>{{t (concat 'file_detail.metadata_' manager.nodeWord)}}</h2>
                                    <div>
                                        {{#each manager.targetMetadata.funders as |funder|}}
                                            <dt>{{t 'file_detail.funder'}}</dt>
                                            <dd data-test-target-funder-name={{funder.funder_name}}>
                                                {{funder.funder_name}}
                                            </dd>
                                            <dt>{{t 'file_detail.award_title'}}</dt>
                                            <dd data-test-target-funder-award-title={{funder.funder_name}}>
                                                {{funder.award_title}}
                                            </dd>
                                            <dt>{{t 'file_detail.award_uri'}}</dt>
                                            <dd data-test-target-funder-award-uri={{funder.funder_name}}>
                                                {{funder.award_uri}}
                                            </dd>
                                            <dt>{{t 'file_detail.award_number'}}</dt>
                                            <dd data-test-target-funder-award-number={{funder.funder_name}}>
                                                {{funder.award_number}}
                                            </dd>
                                        {{/each}}
                                    </div>
                                    <dt>{{t 'file_detail.title'}}</dt>
                                    <dd data-test-target-title>{{manager.target.title}}</dd>
                                    <dt>{{t 'file_detail.description'}}</dt>
                                    <dd data-test-target-description>{{manager.target.description}}</dd>
                                    <dt>{{t 'file_detail.contributors'}}</dt>
                                    <ContributorList
                                        data-test-target-contributors
                                        local-class='contributor-list'
                                        @model={{manager.target}}
                                        @shouldLinkUsers={{true}}
                                        @shouldTruncate={{false}}
                                    />
                                    <dt>{{t 'file_detail.institutions'}}</dt>
                                    <div data-test-target-institutions>
                                        {{#each this.targetInstitutions as |institution|}}
                                            <dd>{{institution.name}}</dd>
                                        {{/each}}
                                    </div>
                                    <dt>{{t 'file_detail.license'}}</dt>
                                    <dd data-test-target-license-name>{{manager.targetLicense.name}}</dd>
                                    <dt>{{t 'file_detail.resource_type_general'}}</dt>
                                    <dd data-test-target-resource-type>{{manager.targetMetadata.resourceTypeGeneral}}</dd>
                                    <dt>{{t 'file_detail.language'}}</dt>
                                    <dd data-test-target-language>{{manager.targetMetadata.language}}</dd>
                                </dl>
                            {{/if}}
                        {{/if}}
                    </FileMetadataManager>
                </div>
            {{/if}}
        {{/if}}
    </:right>
    <:rightButtons>
        {{#if (or this.model.shouldShowTags this.model.shouldShowRevisions) }}
            {{#if this.media.isMobile}}
                <BsButton
                    data-test-file-renderer-button
                    data-analytics-name='File renderer button'
                    local-class='SlideButtons {{if this.rightColumnClosed 'Active'}}'
                    @size='lg'
                    @onClick={{this.toggleFileRenderer}}
                >
                    <FaIcon @icon='file-alt' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
            <BsButton
                aria-label={{if this.metadataOpened (t 'file_detail.close_metadata') (t 'file_detail.view_metadata')}}
                data-test-metadata-button
                data-analytics-name='Metadata button'
                local-class='SlideButtons {{if this.metadataOpened 'Active'}}'
                @size='lg'
                @onClick={{this.toggleMetadata}}
            >
                <FaIcon @icon='info-circle' @fixedWidth={{true}}/>
            </BsButton>
            {{#if this.model.shouldShowRevisions}}
                <BsButton
                    aria-label={{if this.revisionsOpened (t 'file_detail.close_revisions') (t 'file_detail.view_revisions')}}
                    data-test-versions-button
                    data-analytics-name='Versions button'
                    local-class='SlideButtons {{if this.revisionsOpened 'Active'}}'
                    @size='lg'
                    @onClick={{this.toggleRevisions}}
                >
                    <FaIcon @icon='history' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
            {{#if this.model.shouldShowTags}}
                <BsButton
                    aria-label={{if this.tagsOpened (t 'file_detail.close_tags') (t 'file_detail.view_tags')}}
                    data-test-tags-button
                    data-analytics-name='Tags button'
                    local-class='SlideButtons {{if this.tagsOpened 'Active'}}'
                    @size='lg'
                    @onClick={{this.toggleTags}}
                >
                    <FaIcon @icon='tags' @fixedWidth={{true}}/>
                </BsButton>
            {{/if}}
        {{/if}}
    </:rightButtons>
</GuidFile::-Components::FileDetailLayout>
