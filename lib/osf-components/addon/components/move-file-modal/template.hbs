<OsfDialog
    @onOpen={{this.onOpen}}
    @onClose={{this.onClose}}
    @fixedWidth={{true}}
    as |dialog|
>
    <dialog.trigger>
        <Button
            @layout='fake-link'
            {{on 'click' dialog.open}}
        >
            <FaIcon
                @icon='arrow-right'
            />
            {{t 'general.move'}}
        </Button>
    </dialog.trigger>
    <dialog.heading>
        {{t 'osf-components.move_file_modal.header'}}
    </dialog.heading>
    <dialog.main>
        {{#if this.isMoving}}
            <h3>{{t 'osf-components.move_file_modal.moving_files'}}</h3>
            <ul local-class='ChildList'>
                {{#each this.fileMoveTasks as |taskInstance index| }}
                    {{#let (get @filesToMove index) as |file| }}
                        <li local-class='ChildItem MoveItem'>
                            {{#if taskInstance.isRunning}}
                                {{t 'osf-components.move_file_modal.moving_file' fileName=file.name}}
                                <FaIcon @icon='spinner' @pulse={{true}} />
                            {{else if taskInstance.isSuccessful}}
                                {{t 'osf-components.move_file_modal.success' fileName=file.name}}
                                <FaIcon @icon='check' local-class='success'/>
                            {{else if taskInstance.isError}}
                                {{t 'osf-components.move_file_modal.error' fileName=file.name}}
                                <span>
                                    <Button
                                        {{on 'click' (fn this.retry file index)}}
                                    >
                                        {{t 'osf-components.move_file_modal.retry'}}
                                    </Button>
                                    {{#if (eq taskInstance.error.status 409)}}
                                        <Button
                                            {{on 'click' (fn this.replace file index)}}
                                        >
                                            {{t 'osf-components.move_file_modal.replace'}}
                                        </Button>
                                    {{/if}}
                                </span>
                            {{/if}}
                        </li>
                    {{/let}}
                {{/each}}
            </ul>
        {{else}}
            <h3>{{t 'osf-components.move_file_modal.select_destination'}}</h3>
            <div>
                Files to move:
                {{#each @filesToMove as |file|}}
                    {{file.name}}
                {{/each}}
            </div>
            <div local-class='AncestryWrapper'>
                <AncestryDisplay
                    @node={{this.currentNode}}
                    @onAncestorSelect={{this.updateNode}}
                    local-class='AncestryOverride'
                />
                {{#if this.currentFolder}}
                    <Button
                        data-test-go-to-current-node-file-providers
                        @layout='fake-link'
                        {{on 'click' (fn this.updateNode this.currentNode)}}
                    >
                        <NodeCard::NodeIcon @category={{this.currentNode.category}} />
                        {{this.currentNode.title}}
                    </Button>
                {{else}}
                    <span>
                        <NodeCard::NodeIcon @category={{this.currentNode.category}} />
                        {{this.currentNode.title}}
                    </span>
                {{/if}}
                <FileBrowser::Breadcrumbs
                    @breadcrumbs={{this.breadcrumbs}}
                    @currentFolder={{this.currentFolder}}
                    @goToFolder={{this.updateFolder}}
                    local-class='BreadcrumbsOverride'
                />
            </div>
            <InfiniteList
                @itemList={{this.itemList}}
                @hasMore={{this.hasMore}}
                @loadMore={{this.loadMore}}
                @isLoading={{this.isLoading}}
                local-class='ChildList'
            >
                <:item as |item|>
                    <li local-class='ChildItem'>
                        {{#if item.isNode}}
                            <Button
                                @layout='fake-link'
                                local-class='NavButton'
                                {{on 'click' (fn this.updateNode item)}}
                            >
                                <span>
                                    <NodeCard::NodeIcon @category={{item.category}} />
                                    {{item.title}}
                                </span>
                                <FaIcon @icon='chevron-right' />
                            </Button>
                        {{else if item.isFolder}}
                            {{#let (find-by 'name' item.name @filesToMove) as |fileToBeMoved|}}
                                <Button
                                    @layout='fake-link'
                                    local-class='NavButton'
                                    disabled={{fileToBeMoved}}
                                    {{on 'click' (fn this.updateFolder item)}}
                                >
                                    <span>
                                        <FaIcon @icon='folder-open' />
                                        {{item.name}}
                                    </span>
                                    <FaIcon @icon='chevron-right' />
                                </Button>
                            {{/let}}
                        {{else}}
                            <p>{{item.name}}</p>
                        {{/if}}
                    </li>
                </:item>
                <:empty>
                    {{t 'osf-components.move_file_modal.no_children'}}
                </:empty>
            </InfiniteList>
        {{/if}}
    </dialog.main>
    <dialog.footer>
        <Button
            @type='secondary'
            {{on 'click' (queue this.cancelMoves dialog.close)}}
        >
            {{t 'general.cancel'}}
        </Button>
        {{#if this.moveDone}}
            <Button
                @type='primary'
                {{on 'click' dialog.close}}
            >
                {{t 'general.done'}}
            </Button>
        {{else}}
            <Button
                @type='primary'
                disabled={{this.isDisabled}}
                {{on 'click' (perform this.move)}}
            >
                {{t 'general.move'}}
            </Button>
        {{/if}}
    </dialog.footer>
</OsfDialog>
