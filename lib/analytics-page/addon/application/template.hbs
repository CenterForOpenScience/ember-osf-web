{{title (t 'analytics.pageTitle' nodeTitle=node.title)}}
<div class="container">
    <div local-class='Counts' class='row'>
        <div class='col-sm-4 panel panel-default' local-class='CountBox'>
            <div class='panel-body'>
                <h3>{{t 'analytics.forks'}}</h3>
                {{#if loading}}
                    {{loading-indicator dark=true}}
                {{else}}
                    <h2>{{forksCount}}</h2>
                    {{#link-to-external
                        (if node.isProject 'nodeForks' 'registrationForks')
                        model.id
                    }}
                        {{t 'analytics.viewForks'}}
                    {{/link-to-external}}
                {{/if}}
            </div>
        </div>
        <div class='col-sm-4' local-class='CountBox'>
            <div class='panel panel-default'>
                <div class='panel-body'>
                    <h3>{{t 'analytics.links'}}</h3>
                    {{#if loading}}
                        {{loading-indicator dark=true}}
                    {{else}}
                        <h2>{{linkedByCount}}</h2>
                        <a role='button' onclick={{action 'showLinksModal'}}>
                            {{t 'analytics.viewLinks'}}
                        </a>
                        {{#if linksModalShown}}
                            {{#bs-modal-simple
                                title=(t 'analytics.links')
                                closeTitle=(t 'general.close')
                                onHide=(action 'hideLinksModal')
                            }}
                                {{#paginated-relation
                                    model=node
                                    relationshipName='linkedByNodes'
                                    queryParams=linksQueryParams
                                    as |pr|
                                }}
                                    {{#pr.item as |item|}}
                                        {{node-blurb node=item blurbType='generic'}}
                                    {{/pr.item}}

                                    {{#pr.empty}}
                                        {{t 'analytics.noLinks'}}
                                    {{/pr.empty}}
                                {{/paginated-relation}}
                            {{/bs-modal-simple}}
                        {{/if}}
                    {{/if}}
                </div>
            </div>
        </div>
        <div class='col-sm-4 panel panel-default' local-class='CountBox'>
            <div class='panel-body'>
                <h3>{{t 'analytics.templateCopies'}}</h3>
                {{#if loading}}
                    {{loading-indicator dark=true}}
                {{else}}
                    <h2>{{templatedByCount}}</h2>
                {{/if}}
            </div>
        </div>
    </div>

    {{#if nodePublic}}
        {{#unless hideAdblockWarning}}
            {{#bs-alert type='info' onDismissed=(action dismissAdblockWarning)}}
                <div class='text-center'>
                    {{t 'analytics.adblockWarning'}}
                </div>
            {{/bs-alert}}
        {{/unless}}

        <div local-class="PickDateRange">
            <label>
                {{t 'analytics.showForDateRange'}}
                {{#bs-dropdown as |dd|}}
                    {{#dd.button
                        (html-attributes aria-haspopup=true aria-expanded=false)
                        class=(local-class 'DateRangeButton')
                    }}
                        {{t (concat 'analytics.dateRanges.' activeDateRange.key)}}
                        {{fa-icon 'caret-down'}}
                    {{/dd.button}}
                    {{#dd.menu class=(concat (local-class 'DateRangeMenu') ' dropdown-menu-right')}}
                        {{#each dateRanges as |dateRange|}}
                            <li role="menuitem">
                                <a
                                    role="button"
                                    local-class="DateRangeOption"
                                    {{action 'setDateRange' dateRange}}
                                >
                                    {{t (concat 'analytics.dateRanges.' dateRange.key)}}
                                </a>
                            </li>
                        {{/each}}
                    {{/dd.menu}}
                {{/bs-dropdown}}
            </label>
        </div>
    {{else}}
        {{!nodePublic}}
        <div class='row'>
            <div local-class='PrivateProject' class='col-xs-12'>
                {{t 'analytics.privateProject'}}
            </div>
        </div>
    {{/if}}

    <div class='clearfix'></div>
    <div class='row'>
        {{analytics-charts
            chartsEnabled=chartsEnabled
            nodeTaskInstance=model.taskInstance
            startDate=activeDateRange.start
            endDate=activeDateRange.end
        }}
    </div>
</div>